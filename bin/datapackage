#!/usr/bin/env ruby
$:.unshift File.join( File.dirname(__FILE__), "..", "lib")

require 'datapackage'


if ARGV.length == 0
  puts "Usage: datapackage <location>"
  puts "<location> should be a datapackage.json file, directory, or url"
  exit 1
end

package = DataPackage::Package.new(ARGV[0])

messages = package.validate(:simpledataformat)

if messages[:errors].length == 0
    puts "Package #{package.name} is VALID"
else
    puts "Package #{package.name} is INVALID"
    puts "Errors: "
    messages[:errors].each_with_index do |msg, idx|
        puts "#{idx+1}. #{msg[:type]} error. #{msg[:fragment]}"
        puts "  #{msg[:message]}"
    end    
end

if !messages[:warnings].empty?
    puts "Warnings: "
    messages[:warnings].each_with_index do |msg, idx|
        puts "#{idx+1}. #{msg[:type]} warning. #{msg[:fragment]}"
        puts "  #{msg[:message]}"
    end    
end

exit( messages[:errors].length )